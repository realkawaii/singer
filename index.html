<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>手寫隨手記 - 無印風</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;500&display=swap" rel="stylesheet">
    <style>
        :root {
            --muji-beige: #f5f3f0;
            --muji-charcoal: #333333;
            --muji-stone: #e0dbd5;
            --muji-white: #ffffff;
        }

        body {
            margin: 0;
            padding: 0;
            font-family: 'Noto Sans TC', sans-serif;
            background-color: var(--muji-beige);
            color: var(--muji-charcoal);
            overflow-x: hidden;
            display: flex;
            flex-direction: column;
            height: 100vh;
        }

        /* 頂部操作區 */
        .header {
            padding: 15px;
            background: var(--muji-white);
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid var(--muji-stone);
        }

        .header h2 { margin: 0; font-size: 18px; font-weight: 500; }

        /* 全螢幕畫布容器 */
        #canvas-wrap {
            flex: 1; /* 佔滿剩餘空間 */
            position: relative;
            background: var(--muji-white);
            margin: 10px;
            border-radius: 4px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }

        canvas {
            display: block;
            touch-action: none; /* 禁用瀏覽器預設手勢 */
        }

        /* 按鈕風格 */
        .btn-group { display: flex; gap: 8px; }
        button {
            border: 1px solid var(--muji-stone);
            background: var(--muji-white);
            color: var(--muji-charcoal);
            padding: 8px 15px;
            border-radius: 2px;
            font-size: 14px;
            transition: all 0.2s;
        }
        button.save { background: var(--muji-charcoal); color: var(--muji-white); border: none; }
        button:active { opacity: 0.6; }

        /* 歷史紀錄區 */
        #history {
            padding: 15px;
            background: var(--muji-beige);
        }

        .record-card {
            background: var(--muji-white);
            padding: 12px;
            margin-bottom: 12px;
            border-radius: 4px;
            display: flex;
            align-items: center;
            gap: 12px;
            border: 1px solid var(--muji-stone);
        }

        .record-card img {
            width: 80px;
            height: auto;
            border: 1px solid var(--muji-beige);
            background: #fafafa;
        }

        .info { flex: 1; font-size: 13px; }
        .edit-btn { color: #556b2f; border: none; background: none; text-decoration: underline; padding: 5px; }
        .del-btn { color: #a52a2a; border: none; background: none; text-decoration: underline; padding: 5px; }
    </style>
</head>
<body>

    <div class="header">
        <h2>手寫記事</h2>
        <div class="btn-group">
            <button onclick="clearCanvas()">清空</button>
            <button class="save" onclick="saveDrawing()">儲存紀錄</button>
        </div>
    </div>

    <div id="canvas-wrap">
        <canvas id="mainCanvas"></canvas>
    </div>

    <div id="history">
        <h3 style="font-size: 16px; font-weight: 500;">歷史紀錄</h3>
        <div id="recordList"></div>
    </div>

    <script>
        const canvas = document.getElementById('mainCanvas');
        const ctx = canvas.getContext('2d');
        const wrap = document.getElementById('canvas-wrap');
        const recordList = document.getElementById('recordList');
        
        let isDrawing = false;
        let editIndex = null;

        // 設定畫布大小為容器大小（全螢幕感）
        function resizeCanvas() {
            canvas.width = wrap.clientWidth;
            canvas.height = wrap.clientHeight;
            // 重新初始化畫布樣式
            ctx.lineWidth = 3;
            ctx.lineCap = 'round';
            ctx.lineJoin = 'round';
            ctx.strokeStyle = '#333';
        }

        window.addEventListener('load', () => {
            resizeCanvas();
            renderRecords();
        });

        // 繪圖邏輯
        function getPos(e) {
            const rect = canvas.getBoundingClientRect();
            const clientX = e.touches ? e.touches[0].clientX : e.clientX;
            const clientY = e.touches ? e.touches[0].clientY : e.clientY;
            return {
                x: clientX - rect.left,
                y: clientY - rect.top
            };
        }

        function startDrawing(e) {
            isDrawing = true;
            const pos = getPos(e);
            ctx.beginPath();
            ctx.moveTo(pos.x, pos.y);
            e.preventDefault();
        }

        function draw(e) {
            if (!isDrawing) return;
            const pos = getPos(e);
            ctx.lineTo(pos.x, pos.y);
            ctx.stroke();
            e.preventDefault();
        }

        function stopDrawing() { isDrawing = false; }

        canvas.addEventListener('mousedown', startDrawing);
        canvas.addEventListener('mousemove', draw);
        window.addEventListener('mouseup', stopDrawing);

        canvas.addEventListener('touchstart', startDrawing, {passive: false});
        canvas.addEventListener('touchmove', draw, {passive: false});
        canvas.addEventListener('touchend', stopDrawing);

        function clearCanvas() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            editIndex = null;
        }

        function saveDrawing() {
            const dataURL = canvas.toDataURL();
            let saved = JSON.parse(localStorage.getItem('my_drawings') || '[]');

            if (editIndex !== null) {
                saved[editIndex] = dataURL;
                editIndex = null;
            } else {
                saved.unshift(dataURL); // 最新存放在最前面
            }

            localStorage.setItem('my_drawings', JSON.stringify(saved));
            clearCanvas();
            renderRecords();
        }

        function renderRecords() {
            recordList.innerHTML = '';
            const saved = JSON.parse(localStorage.getItem('my_drawings') || '[]');

            saved.forEach((data, index) => {
                const card = document.createElement('div');
                card.className = 'record-card';
                card.innerHTML = `
                    <img src="${data}">
                    <div class="info">紀錄 #${saved.length - index}</div>
                    <button class="edit-btn" onclick="editRecord(${index})">編輯</button>
                    <button class="del-btn" onclick="deleteRecord(${index})">刪除</button>
                `;
                recordList.appendChild(card);
            });
        }

        function deleteRecord(index) {
            if(!confirm("確定要刪除嗎？")) return;
            let saved = JSON.parse(localStorage.getItem('my_drawings') || '[]');
            saved.splice(index, 1);
            localStorage.setItem('my_drawings', JSON.stringify(saved));
            renderRecords();
        }

        function editRecord(index) {
            const saved = JSON.parse(localStorage.getItem('my_drawings') || '[]');
            const img = new Image();
            img.onload = function() {
                clearCanvas();
                ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
                editIndex = index;
                window.scrollTo({ top: 0, behavior: 'smooth' });
            };
            img.src = saved[index];
        }
    </script>
</body>
</html>
